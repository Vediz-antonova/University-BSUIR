{% extends 'base.html' %}
{% load static %}
{% load carts_tags %}

{% block css %}
  <link rel="stylesheet" href="{% static 'css/carts/included_cart.css' %}">
  <link rel="stylesheet" href="{% static 'css/orders/create_order.css' %}">
{% endblock %}

{% block content %}
  {% user_carts request as carts %}
  <section class="order-wrapper">
    <div class="order-container">
      <h2 class="order-title">Выбранные товары</h2>
      <div id="cart-items-container">
        {% include "carts/includes/included_cart.html" %}
      </div>

      <h2 class="order-title">Детали заказа</h2>
      <form action="{% url "create_order" %}" method="post" id="create_order_form">
        {% csrf_token %}
        <div class="form-grid">
          <div class="form-group">
            <label for="id_first_name">Имя*:</label>
            <input type="text" id="id_first_name" name="first_name"
                   value="{{ form.first_name.value|default_if_none:'' }}" required>
            {% if form.first_name.errors %}
              <p class="form-error">{{ form.first_name.errors }}</p>
            {% endif %}
          </div>

          <div class="form-group">
            <label for="id_last_name">Фамилия*:</label>
            <input type="text" id="id_last_name" name="last_name"
                   value="{{ form.last_name.value|default_if_none:'' }}" required>
            {% if form.last_name.errors %}
              <p class="form-error">{{ form.last_name.errors }}</p>
            {% endif %}
          </div>

          <div class="form-group">
            <label for="id_phone_number">Номер телефона*:</label>
            <input type="text" id="id_phone_number" name="phone_number"
                   value="{{ form.phone_number.value|default_if_none:'' }}"
                   placeholder="+375 (29) XXX-XX-XX" required>
            {% if form.phone_number.errors %}
              <p class="form-error">{{ form.phone_number.errors }}</p>
            {% endif %}
            <p class="form-error" id="phone_number_error" style="display: none;">Неверный формат номера</p>
          </div>

          <div class="form-group full-width">
            <label>Способ доставки:</label>
            <div class="radio-group">
              <label><input type="radio" name="requires_delivery" value="1" checked> Нужна доставка</label>
              <label><input type="radio" name="requires_delivery" value="0"> Самовывоз</label>
            </div>
          </div>

          <div class="form-group full-width" id="deliveryAddressField">
            <label for="id_delivery_address">Адрес доставки*:</label>
            <textarea id="id_delivery_address" name="delivery_address" rows="2">{{ form.delivery_address.value }}</textarea>
            {% if form.delivery_address.errors %}
              <p class="form-error">{{ form.delivery_address.errors }}</p>
            {% endif %}
          </div>

          <div class="form-group full-width">
            <label>Способ оплаты:</label>
            <div class="radio-group">
              <label><input type="radio" name="payment_on_get" value="0" checked> Оплата картой</label>
              <label><input type="radio" name="payment_on_get" value="1"> Наличными/картой при получении</label>
            </div>
            {% if form.payment_on_get.errors %}
              <p class="form-error">{{ form.payment_on_get.errors }}</p>
            {% endif %}
          </div>

          <div class="form-group">
            <label for="id_promo_code">Промокод:</label>
            <input type="text" id="id_promo_code" name="promo_code"
                   value="{{ form.promo_code.value|default_if_none:'' }}"
                   placeholder="Введите промокод (если есть)" maxlength="10">
            {% if form.promo_code.errors %}
              <p class="form-error">{{ form.promo_code.errors }}</p>
            {% endif %}
          </div>
        </div>

        <button type="submit" class="order-submit">Оформить заказ</button>
      </form>
    </div>
  </section>
{% endblock %}
